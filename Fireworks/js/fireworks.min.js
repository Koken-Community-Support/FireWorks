var canvasID="fireworks";var textWrapp="fw_center";var yearID="year";var FireworkSession="KokenFireWorksOnce";var FireworkText=document.getElementById(textWrapp);if(sessionStorage.getItem(FireworkSession)!=="true"){var gc=new GameCanvas();var gc_id=document.getElementsByTagName("canvas")[0].setAttribute("id",canvasID);var NewYear=new Date().getFullYear()+1;var year;var yearCounter=0;var gravity=0.15;var fireworks=[new Firework()];var particles=[];var fireworkInterval;setInterval(function(){fireworkInterval=fireworks.push(new Firework())},fireworksTime);window.onfocus=function(){fireworks=[];particles=[]};function start(){year=document.getElementById(yearID);year.innerHTML="0"}function loop(){rect(0,0,width,height,canvasBkgrd);for(var a=0;a<fireworks.length;a++){fireworks[a].update()}for(var a=0;a<particles.length;a++){particles[a].update()}year.innerHTML=Math.ceil(yearCounter);yearCounter+=(NewYear-yearCounter)/20}function Firework(){var b=this;this.x=Math.random()*width;this.y=height;this.vy=-(Math.random()*5+10);this.color="hsl("+Math.random()*360+", 100%, 50%)";this.update=function(){this.y+=this.vy;this.vy+=gravity;if(Math.abs(this.vy)<=0.1){for(var c=0;c<360;c++){particles.push(new a(this.x,this.y,c,Math.random()*5))}fireworks.splice(fireworks.indexOf(this),1)}circle(this.x,this.y,3,this.color)};function a(c,f,d,e){this.x=c;this.y=f;this.dir=d;this.power=e;this.vx=Math.cos(this.dir*Math.PI/180)*this.power;this.vy=Math.sin(this.dir*Math.PI/180)*this.power;this.health=100;this.hsl=b.color.replace(/[^\d,]/g,"").split(",");this.update=function(){this.x+=this.vx;this.y+=this.vy;this.vx*=0.98;this.vy*=0.98;this.vy+=gravity;this.health--;if(this.health<=0){particles.splice(particles.indexOf(this),1)}rect(this.x-2,this.y-2,4,4,"hsla("+this.hsl[0]+","+this.hsl[1]+"%,"+this.hsl[2]+"%,"+this.health/100+")")}}}setTimeout(function(){function a(){var b=document.getElementById(canvasID);var c=setInterval(function(){if(!b.style.opacity){b.style.opacity=1;FireworkText.style.opacity=1}if(b.style.opacity>0){b.style.opacity-=0.1;FireworkText.style.opacity-=0.1;if(b.style.opacity==0){b.remove();FireworkText.remove()}}else{clearInterval(c)}},fadeTime)}a();sessionStorage.setItem(FireworkSession,"true")},waitTime)}else{console.log("KokenFireworks has already run");FireworkText.remove()};