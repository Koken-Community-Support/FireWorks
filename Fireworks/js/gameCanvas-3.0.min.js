/*! GameCanvas gc.js
 *	@copyright	(c) 2018 Alfons Nilsson - https://aaserver.net
 *	@license MIT
 *	@author: Alfons Nilsson github.com/TheCoder5550
 *	@version 3.0
 *	@description gc.js or gameCanvas.js is a lightweight javascript library. The library is built on the Canvas API and makes it a lot easier to create and draw to the HTML Canvas.
 *	@documentation https://aaserver.net/libraries/gameCanvas/documentation.html
 *	@url https://aaserver.net/libraries/gameCanvas/
**/
function GameCanvas(b,d,a,c){var f=this;if(arguments.length==0){b=null;d="FULLSCREEN"}if(typeof b==="string"){b=document.getElementById(b)}this.canvas=b||document.body.appendChild(document.createElement("canvas"));d=d||"FULLSCREEN";if(d=="FULLSCREEN"){c=a||c;document.body.style=(c&&c.appliedBodyStyle)||"padding: 0;margin: 0;";this.canvas.height=window.innerHeight}else{this.canvas.height=a}this.canvas.width=(d=="FULLSCREEN"?window.innerWidth:d);this.ctx=this.canvas.getContext("2d");this.settings=c;this.globalFunctions=(c&&c.hasOwnProperty("globalFunctions"))?c.globalFunctions:true;this.topFunction=this.globalFunctions?window:this;this.imagesToLoad=0;this.preloadedImages=[];this.storedImages=[];this.storedImageData=[];this.topFunction.width=this.canvas.width;this.topFunction.height=this.canvas.height;this.topFunction.isItWorking=function(){msg="Yup, it's working!\n(This function can be removed from your code now if you want)";console.log(msg)};window.onload=function(){if(typeof preload!=="undefined"&&typeof preload==="function"){preload()}else{var g=loop;loop=function(){g();requestAnimationFrame(loop)};try{start()}catch(h){console.log(h)}try{loop()}catch(h){console.log(h)}}};this.topFunction.clearScreen=function(){f.ctx.clearRect(0,0,f.canvas.width,f.canvas.height)};this.topFunction.drawRectangle=function(h,m,j,g,l,k,i){f.ctx.beginPath();f.ctx.rect(h,m,j,g);f.ctx.closePath();f.topFunction.renderShape(l,k,i)};this.topFunction.rect=this.topFunction.drawRectangle;this.topFunction.rectangle=this.topFunction.drawRectangle;this.topFunction.drawCircle=function(h,l,g,k,j,i){f.ctx.beginPath();f.ctx.arc(h,l,g,0,2*Math.PI);f.ctx.closePath();f.topFunction.renderShape(k,j,i)};this.topFunction.circle=this.topFunction.drawCircle;this.topFunction.drawRing=function(i,k,h,j,g){f.topFunction.drawCircle(i,k,h,"",j,g?{lineWidth:g}:undefined)};this.topFunction.ring=this.topFunction.drawRing;this.topFunction.drawTriangle=function(i,m,h,l,g,k,n,o,j){f.ctx.beginPath();if(i.hasOwnProperty("x")){f.ctx.moveTo(i.x,i.y);f.ctx.lineTo(m.x,m.y);f.ctx.lineTo(h.x,h.y);color=l;j=g}else{f.ctx.moveTo(i,m);f.ctx.lineTo(h,l);f.ctx.lineTo(g,k)}f.ctx.closePath();f.topFunction.renderShape(n,o,j)};this.topFunction.triangle=this.topFunction.drawTriangle;this.topFunction.tri=this.topFunction.drawTriangle;this.topFunction.drawTriangleEquilateral=function(p,n,k,q,r,j){var i=p+Math.cos(30*Math.PI/180)*((j&&j.width)||k);var o=n+Math.sin(30*Math.PI/180)*((j&&j.height)||k);var h=p+Math.cos(150*Math.PI/180)*((j&&j.width)||k);var m=n+Math.sin(150*Math.PI/180)*((j&&j.height)||k);var g=p;var l=n-k;f.topFunction.drawTriangle(i,o,h,m,g,l,q,r,j)};this.topFunction.triangleEq=this.topFunction.drawTriangleEquilateral;this.topFunction.drawRegularPolygon=function(o,m,k,l,p,q,h){f.ctx.beginPath();for(var j=-90;j<270;j+=360/l){var g=o+Math.cos(j*Math.PI/180)*((h&&h.width)||k);var n=m+Math.sin(j*Math.PI/180)*((h&&h.height)||k);if(j==-90){f.ctx.moveTo(g,n)}else{f.ctx.lineTo(g,n)}}f.ctx.closePath();f.topFunction.renderShape(p,q,h)};this.topFunction.regPolygon=this.topFunction.drawRegularPolygon;this.topFunction.drawEllipse=function(h,m,j,g,l,k,i){f.ctx.beginPath();f.ctx.ellipse(h,m,j,g,(i&&i.rotation)||0,0,Math.PI*2);f.ctx.closePath();f.topFunction.renderShape(l,k,i)};this.topFunction.ellipse=this.topFunction.drawEllipse;this.topFunction.oval=this.topFunction.drawEllipse;this.topFunction.preloadImage=function(i){var h=f.preloadedImages.find(function(j){return j.src===i});console.log("Preloading image... "+i);if(!h){f.imagesToLoad++;var g=new Image();g.src=i;g.onload=function(){f.imagesToLoad--;if(f.imagesToLoad<=0){if(typeof loop==="function"){var j=loop;loop=function(){j();requestAnimationFrame(loop)}}try{start()}catch(k){console.log(k)}try{loop()}catch(k){console.log(k)}}console.log("Image preloaded! "+g.src)};f.preloadedImages.push({src:i,image:g});return g}};this.topFunction.drawImage=function(m,h,n,k,g,j){var l=f.preloadedImages.find(function(o){return o.src===m});if(l){if(j&&j.rotation!==undefined&&j.rotation!==null){f.ctx.save();f.ctx.translate(h,n);f.ctx.rotate(j.rotation);f.ctx.drawImage(l.image,-k/2,-g/2,k,g);f.ctx.restore()}else{f.ctx.drawImage(l.image,h,n,k,g)}}else{var i=f.topFunction.preloadImage(m);i.onload=function(){f.ctx.drawImage(i,h,n,k,g)}}};this.topFunction.image=this.topFunction.drawImage;this.topFunction.picture=this.topFunction.drawImage;this.topFunction.imageReadPixel=function(j,h,k){var g=f.storedImageData.find(function(l){return l.src===j});if(g){if(g.imagePixelReader.isDoneLoading){return g.imagePixelReader.readPixel(h,k)}else{return"Data is added, but has not loaded yet"}}else{var i=new f.topFunction.ImagePixelReader(j);f.storedImageData.push({src:j,imagePixelReader:i});return i.readPixel(h,k)}};this.topFunction.ImagePixelReader=function(i){var g=this;var h=f.preloadedImages.find(function(j){return j.src===i});if(h){g.image=h.image;g.isDoneLoading=true;g.canvas=document.createElement("canvas");g.canvas.width=g.image.width;g.canvas.height=g.image.height;g.ctx=g.canvas.getContext("2d");g.ctx.drawImage(g.image,0,0);g.imageData=g.ctx.getImageData(0,0,g.image.width,g.image.height).data}else{console.error("Please preload image before getting data!")}this.readPixel=function(j,l){if(g.isDoneLoading){var k=(j+l*g.image.height)*4;return[g.imageData[k],g.imageData[k+1],g.imageData[k+2],g.imageData[k+3]]}else{console.log("Is loading!..")}};this.onload=function(){}};this.topFunction.drawLine=function(i,l,h,j,g,k){f.ctx.beginPath();if(i.hasOwnProperty("x")){f.ctx.moveTo(i.x,i.y);f.ctx.lineTo(l.x,l.y);g=h;k=j}else{f.ctx.moveTo(i,l);f.ctx.lineTo(h,j)}f.ctx.closePath();f.ctx.lineCap=(k&&k.roundedCorners)?"round":"butt";f.ctx.strokeStyle=g;f.ctx.lineWidth=(k&&k.lineWidth)||2;f.ctx.stroke()};this.topFunction.line=this.topFunction.drawLine;this.topFunction.drawPoint=function(g,h){if(g.hasOwnProperty("x")){h=g.y;g=g.x}f.topFunction.drawCircle(g,h,5,"black")};this.topFunction.point=this.topFunction.drawPoint;this.topFunction.drawText=function(l,g,m,i,k,j,h){if(typeof j==="object"&&j.toString()==="[object Object]"){h=j;j=""}f.ctx.beginPath();f.ctx.font=(i||30)+"px "+(h&&h.fontFamily)||"Arial";f.ctx.textAlign=(h&&h.alignText)||"left";f.ctx.lineWidth=(h&&h.lineWidth)||2;f.ctx.closePath();if(k){f.ctx.fillStyle=k;f.ctx.fillText(l,g,m)}if(j){f.ctx.strokeStyle=j;f.ctx.strokeText(l,g,m)}};this.topFunction.text=this.topFunction.drawText;this.topFunction.drawPolygon=function(k,n,m,j){var h=(k.constructor===Array?k:arguments);f.ctx.beginPath();f.ctx.moveTo(h[0].x,h[0].y);for(var g=1;g<h.length;g++){var l=h[g];f.ctx.lineTo(l.x,l.y)}f.ctx.closePath();f.topFunction.renderShape(n,m,j)};this.topFunction.polygon=this.topFunction.drawPolygon;this.topFunction.gradient=function(n,l,h,k){var g;if(n.constructor===Array){k=h;h=l;g=n}else{g=[n,l]}var m=f.ctx.createLinearGradient(0,0,0,h||100);for(var j=0;j<g.length;j++){m.addColorStop((1/(g.length-1))*j,g[j])}return m};this.topFunction.beginShape=function(){f.ctx.beginPath()};this.topFunction.moveTo=function(g,h){f.ctx.moveTo(g,h)};this.topFunction.lineTo=function(g,h){f.ctx.lineTo(g,h)};this.topFunction.curveTo=function(g,j,h,i){f.ctx.quadraticCurveTo(h,i,g,j)};this.topFunction.closeShape=function(){f.ctx.closePath()};this.topFunction.renderShape=function(i,h,g){if(typeof i==="object"&&i.toString()==="[object Object]"){g=i;i=""}if(typeof h==="object"&&h.toString()==="[object Object]"){g=h;h=""}f.ctx.lineJoin=(g&&g.roundedCorners)?"round":"miter";f.ctx.lineWidth=(g&&g.lineWidth)||2;if(g&&g.hasOwnProperty("fillColor")){f.ctx.fillStyle=g.fillColor;f.ctx.fill()}if(g&&g.hasOwnProperty("strokeColor")){f.ctx.strokeStyle=g.strokeColor;f.ctx.stroke()}if(i){f.ctx.fillStyle=i;f.ctx.fill()}if(h){f.ctx.strokeStyle=h;f.ctx.stroke()}};this.topFunction.getDistance=function(j,l,i,k){if(j.hasOwnProperty("x")){k=l.y;i=l.x;l=j.y;j=j.x}var h=j-i;var g=l-k;return Math.sqrt(h*h+g*g)};this.topFunction.distance=this.topFunction.getDistance;this.topFunction.getAngle=function(h,k,g,i,j){if(h.hasOwnProperty("x")){j=g;i=k.y;g=k.x;k=h.y;h=h.x}if(j&&j.angleMode&&(j.angleMode.toUpperCase()=="DEG"||j.angleMode.toUpperCase()=="DEGREES")){return Math.atan2(i-k,g-h)*180/Math.PI}else{if((j&&j.angleMode&&(j.angleMode.toUpperCase()=="RAD"||j.angleMode.toUpperCase()=="RADIUS"))||!j){return Math.atan2(i-k,g-h)}}};this.topFunction.canvasToURL=function(){return f.canvas.toDataURL()};this.topFunction.canvasToImage=function(){var g=new Image();g.src=f.canvas.toDataURL();return g};this.topFunction.downloadCanvasPNG=function(h){var g=document.createElement("a");g.download=h||"downloadCanvasPNG.png";g.href=f.canvas.toDataURL();g.click()};this.topFunction.swap=function(h,g){return[g,h]};this.topFunction.createArray=function(h,g){return e(0,h,g||10)};function e(j,l,k){var g=new Array(k);for(var h=0;h<g.length;h++){g[h]=j<l-2?e(j+1,l,k):new Array(k)}return g}this.topFunction.mouse={x:0,y:0,left:false,middle:false,right:false};this.topFunction.mouseX=0;this.topFunction.mouseY=0;this.keyNumber=[];this.keyName=[];this.topFunction.isKeyPressed=function(g){if(isNaN(g)){return f.keyName[g]?true:false}else{return f.keyNumber[g]?true:false}};this.topFunction.getKey=this.topFunction.isKeyPressed;this.canvas.addEventListener("mousemove",function(h){var g=f.canvas.getBoundingClientRect();f.topFunction.mouse.x=f.topFunction.mouseX=Math.round((h.clientX-g.left)*(f.topFunction.width/g.width));f.topFunction.mouse.y=f.topFunction.mouseY=Math.round((h.clientY-g.top)*(f.topFunction.height/g.height));typeof OnMouseMove==="function"&&OnMouseMove()});this.canvas.addEventListener("mousedown",function(g){switch(g.which){case 1:f.topFunction.mouse.left=true;break;case 2:f.topFunction.mouse.middle=true;break;case 3:f.topFunction.mouse.right=true;break}typeof OnMouseDown==="function"&&OnMouseDown()});this.canvas.addEventListener("mouseup",function(g){switch(g.which){case 1:f.topFunction.mouse.left=false;break;case 2:f.topFunction.mouse.middle=false;break;case 3:f.topFunction.mouse.right=false;break}typeof OnMouseUp==="function"&&OnMouseUp()});document.addEventListener("keydown",function(g){f.keyNumber[g.which]=true;f.keyName[g.key]=true;typeof OnKeyDown==="function"&&OnKeyDown()});document.addEventListener("keyup",function(g){f.keyNumber[g.which]=false;f.keyName[g.key]=false;typeof OnKeyUp==="function"&&OnkeyUp()})};