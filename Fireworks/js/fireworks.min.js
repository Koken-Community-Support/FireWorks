/*! Fireworks fireworks.js
 *  Copyright  (c) 2015-2017 Bjarne Varoystrand - bjarne ○ kokensupport • com
 *  License: GPL
 *  @author Alfons Nilsson (https://aaserver.net)
 *  @author Bjarne Varoystrand (@black_skorpio)
 *  @version 1.1.0
 *  @description Fireworks for Koken, based on the original work of Alfins Nilsson
 *  http://varoystrand.se | http://kokensupport.com
**/
var canvasID="fireworks";var textWrapp="fw_center";var yearID="year";var footWrap="fw_foot";var devHost="oxygen.local";var deBugState=0;var demoHost="demo.kokensupport.com";var demoState=0;var debugHash="fireworksDebug";var demoHash="fireworksDemo";var currentTime=new Date();var currentYear=currentTime.getFullYear();if(spanYear==1){var NewYear=currentTime.getFullYear()+1}else{var NewYear=currentTime.getFullYear()}var startDate=new Date(startValue+"/"+currentYear);var endDate=new Date(endValue+"/"+NewYear);var dateCheck=currentTime>startDate&&currentTime<endDate;var debugCheck=deBugState==1||(location.hostname==devHost||location.hash=="#"+debugHash);var demoCheck=(demoState==1||location.hash=="#"+demoHash)||location.hostname==demoHost;var FwFooter=document.getElementById(footWrap);var FireworkText=document.getElementById(textWrapp);var FireworkCanvas=document.getElementById(canvasID);var FireworksKey="KokenFireWorks";var FireworksValue=NewYear+"."+location.hostname;var storageCheck=sessionStorage.getItem(FireworksKey)!==FireworksValue;function theBroom(){if(FwFooter!=null){FwFooter.remove()}if(FireworkText!=null){FireworkText.remove()}if(FireworkCanvas!=null){FireworkCanvas.remove()}if(debugCheck){console.info("Cleaning up after the Fireworks")}}if(debugCheck){function deBugger(){var c=console;var a="font:1.5em sans-serif; color:orange;";var e="font:1 sans-serif;";var f="color:green;";var d="color:red;";var b="\n--------------------------------------------------\n\n";c.debug("%c-=- Koken Fireworks is in debug mode -=-",a);if(dateCheck){c.debug("%c"+currentTime+" is in range "+startDate+" and "+endDate,e+f,b)}else{c.debug("%c"+currentTime+" is not between "+startDate+" and "+endDate,e+d,b)}if(demoCheck){c.debug("%c-=- Koken Fireworks is in demo mode -=-",a)}c.debug("%c-=- The Element ID's -=-",a);c.debug("canvasID: #"+canvasID+"\ntextWrapp: #"+textWrapp+"\nyearID: #"+yearID+"\nfootWrap: #"+footWrap+b);c.debug("%c-=- Debug info -=-",a);c.debug("devHost: "+devHost+"\ndeBugState: "+deBugState+"\ndebugHash: #"+debugHash+"\ndemoState: "+demoState+"\ndemoHost: "+demoHost+"\ndemoHash: #"+demoHash+b);c.debug("%c-=- Checks -=-",a);c.debug("dateCheck: "+dateCheck+"\ndebugCheck: "+debugCheck+"\ndemoCheck: "+demoCheck+"\nspanYear: "+spanYear+b);c.debug("%c-=- Dates and timings -=-",a);c.debug("currentTime: "+currentTime+"\ncurrentYear: "+currentYear+"\nNewYear: "+NewYear+"\nstartDate: "+startDate+"\nendDate: "+endDate+"\nwaitTime: "+waitTime+"ms\nfadeTime: "+fadeTime+"ms\nfireworksTime: "+fireworksTime+"ms"+b);c.debug("%c-=- Objects -=-",a);c.debug("FwFooter: "+FwFooter+"\nFireworkText: "+FireworkText+"\nFireworkCanvas: "+FireworkCanvas+b);c.debug("%c-=- Session Storage -=-",a);c.debug("FireworksKey: "+FireworksKey+"\nFireworksValue: "+FireworksValue)}deBugger()}if((demoCheck||dateCheck)&&storageCheck){var gc=new GameCanvas(canvasID);var year;var yearCounter=0;var gravity=0.15;var fireworks=[new Firework()];var particles=[];var fireworkInterval;setInterval(function(){fireworkInterval=fireworks.push(new Firework())},fireworksTime);window.onfocus=function(){fireworks=[];particles=[]};function start(){year=document.getElementById(yearID);year.innerHTML="0"}function loop(){rect(0,0,width,height,canvasBkgrd);for(var a=0;a<fireworks.length;a++){fireworks[a].update()}for(var a=0;a<particles.length;a++){particles[a].update()}year.innerHTML=Math.ceil(yearCounter);yearCounter+=(NewYear-yearCounter)/20}function Firework(){var b=this;this.x=Math.random()*width;this.y=height;this.vy=-(Math.random()*5+10);this.color="hsl("+Math.random()*360+", 100%, 50%)";this.update=function(){this.y+=this.vy;this.vy+=gravity;if(Math.abs(this.vy)<=0.1){for(var c=0;c<360;c++){particles.push(new a(this.x,this.y,c,Math.random()*5))}fireworks.splice(fireworks.indexOf(this),1)}circle(this.x,this.y,3,this.color)};function a(c,f,d,e){this.x=c;this.y=f;this.dir=d;this.power=e;this.vx=Math.cos(this.dir*Math.PI/180)*this.power;this.vy=Math.sin(this.dir*Math.PI/180)*this.power;this.health=100;this.hsl=b.color.replace(/[^\d,]/g,"").split(",");this.update=function(){this.x+=this.vx;this.y+=this.vy;this.vx*=0.98;this.vy*=0.98;this.vy+=gravity;this.health--;if(this.health<=0){particles.splice(particles.indexOf(this),1)}rect(this.x-2,this.y-2,4,4,"hsla("+this.hsl[0]+","+this.hsl[1]+"%,"+this.hsl[2]+"%,"+this.health/100+")")}}}setTimeout(function(){function a(){var b=setInterval(function(){if(!FireworkCanvas.style.opacity){FireworkCanvas.style.opacity=1;FireworkText.style.opacity=1}if(FireworkCanvas.style.opacity>0){FireworkCanvas.style.opacity-=0.1;FireworkText.style.opacity-=0.1;if(FireworkCanvas.style.opacity==0){theBroom()}}else{clearInterval(b)}},fadeTime)}a();sessionStorage.setItem(FireworksKey,FireworksValue)},waitTime)}else{theBroom()};